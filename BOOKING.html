<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ứng dụng Quản lý Booking & Chia Phòng</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }
        
        header p {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .tabs {
            display: flex;
            background-color: #f1f5f9;
            border-bottom: 1px solid #ddd;
        }
        
        .tab-button {
            flex: 1;
            padding: 18px 20px;
            background: none;
            border: none;
            font-size: 17px;
            font-weight: 600;
            color: #555;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .tab-button:hover {
            background-color: #e8eff5;
        }
        
        .tab-button.active {
            background-color: white;
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
        }
        
        .tab-content {
            padding: 30px;
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section-title {
            font-size: 22px;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: #3498db;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }
        
        input, select, button, textarea {
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            width: 100%;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #3498db;
            outline: none;
        }
        
        input.uppercase {
            text-transform: uppercase;
        }
        
        textarea.uppercase {
            text-transform: uppercase;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-col {
            flex: 1;
        }
        
        .form-col-2 {
            flex: 2;
        }
        
        .form-col-3 {
            flex: 3;
        }
        
        .btn {
            padding: 13px 25px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .btn-secondary {
            background-color: #7f8c8d;
        }
        
        .btn-secondary:hover {
            background-color: #6c7b7d;
        }
        
        .btn-success {
            background-color: #27ae60;
        }
        
        .btn-success:hover {
            background-color: #219653;
        }
        
        .btn-warning {
            background-color: #f39c12;
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
        }
        
        .btn-danger {
            background-color: #e74c3c;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-sm {
            padding: 8px 15px;
            font-size: 14px;
        }
        
        .booking-list, .tour-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }
        
        .booking-card, .tour-card {
            background-color: #f9fbfd;
            border-radius: 10px;
            padding: 25px;
            border: 1px solid #e1e8f0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }
        
        .booking-card:hover, .tour-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .booking-header, .tour-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eaeaea;
        }
        
        .booking-title, .tour-title {
            font-weight: 700;
            font-size: 20px;
            color: #2c3e50;
        }
        
        .booking-customer-count, .tour-customer-count {
            background-color: #3498db;
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 600;
        }
        
        .room-assignment-section {
            margin-top: 20px;
        }
        
        .room-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .room-card {
            background-color: white;
            border-radius: 8px;
            padding: 18px;
            border: 1px solid #e1e8f0;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }
        
        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #eaeaea;
        }
        
        .room-title {
            font-weight: 700;
            font-size: 16px;
            color: #2c3e50;
        }
        
        .room-capacity {
            background-color: #27ae60;
            color: white;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 13px;
        }
        
        .staff-list {
            list-style-type: none;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .staff-list li {
            padding: 8px 10px;
            background-color: #f8f9fa;
            margin-bottom: 6px;
            border-radius: 4px;
            border-left: 4px solid #3498db;
            font-size: 14px;
        }
        
        .duplicate-warning {
            color: #e74c3c;
            font-weight: 600;
            font-size: 14px;
            margin-top: 5px;
            padding: 10px;
            background-color: #fdf2f2;
            border-radius: 5px;
            border-left: 4px solid #e74c3c;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .stat-card {
            background-color: #f9fbfd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            border: 1px solid #e1e8f0;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #3498db;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .alert-success {
            background-color: #d5edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eaeaea;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 700;
            color: #2c3e50;
        }
        
        tr:hover {
            background-color: #f9fbfd;
        }
        
        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }
        
        .badge-success {
            background-color: #d5edda;
            color: #155724;
        }
        
        .badge-warning {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .badge-danger {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .badge-info {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .today-date {
            font-size: 16px;
            color: #7f8c8d;
            margin-top: 10px;
            text-align: center;
        }
        
        .booking-details, .tour-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .detail-row {
            display: flex;
            margin-bottom: 8px;
        }
        
        .detail-label {
            font-weight: 600;
            width: 150px;
            color: #555;
        }
        
        .detail-value {
            color: #333;
            flex: 1;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 14px;
            border-top: 1px solid #eee;
            margin-top: 30px;
        }
        
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #7f8c8d;
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .filter-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
        }
        
        .staff-off-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background-color: white;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #eaeaea;
        }
        
        .staff-off-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .staff-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #3498db;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .booking-status-future {
            border-left: 5px solid #3498db;
        }
        
        .booking-status-today {
            border-left: 5px solid #27ae60;
        }
        
        .booking-status-past {
            border-left: 5px solid #95a5a6;
        }
        
        .tab-submenu {
            display: flex;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .submenu-btn {
            padding: 10px 20px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: #555;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s;
        }
        
        .submenu-btn:hover {
            background-color: #e9ecef;
        }
        
        .submenu-btn.active {
            background-color: #3498db;
            color: white;
        }
        
        .room-actions {
            margin-top: 10px;
            display: flex;
            gap: 5px;
        }
        
        .btn-remove-room {
            padding: 5px 10px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.3s;
        }
        
        .btn-remove-room:hover {
            background-color: #c0392b;
        }
        
        .duration-input-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .duration-input {
            flex: 1;
        }
        
        .duration-unit {
            font-weight: 600;
            color: #555;
            white-space: nowrap;
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .booking-list, .tour-list, .room-list {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .tab-button {
                padding: 15px 10px;
                font-size: 14px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .tab-submenu {
                flex-direction: column;
            }
            
            .duration-input-container {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-hotel"></i> ỨNG DỤNG QUẢN LÝ BOOKING & CHIA PHÒNG</h1>
            <p>QUẢN LÝ 50 NHÂN VIÊN VÀ PHÂN CHIA VÀO CÁC PHÒNG 2-6 NGƯỜI</p>
            <div class="today-date" id="todayDate"></div>
        </header>
        
        <div class="tabs">
            <button class="tab-button active" data-tab="booking">
                <i class="fas fa-calendar-check"></i> NHẬN BOOKING
            </button>
            <button class="tab-button" data-tab="room-assignment">
                <i class="fas fa-door-open"></i> CHIA PHÒNG
            </button>
            <button class="tab-button" data-tab="future-bookings">
                <i class="fas fa-calendar-alt"></i> BOOKING TƯƠNG LAI
            </button>
            <button class="tab-button" data-tab="staff-off">
                <i class="fas fa-user-slash"></i> NHÂN VIÊN OFF
            </button>
            <button class="tab-button" data-tab="statistics">
                <i class="fas fa-chart-bar"></i> THỐNG KÊ
            </button>
        </div>
        
        <!-- Tab Nhận Booking -->
        <div id="booking" class="tab-content active">
            <h2 class="section-title"><i class="fas fa-calendar-plus"></i> THÔNG TIN BOOKING</h2>
            
            <div id="bookingAlert" class="alert" style="display:none;"></div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="tourName"><i class="fas fa-map-marked-alt"></i> TÊN BOOKING/TOUR</label>
                        <input type="text" id="tourName" class="uppercase" placeholder="NHẬP TÊN BOOKING/TOUR...">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="tourDate"><i class="fas fa-calendar-day"></i> NGÀY BOOKING</label>
                        <input type="date" id="tourDate">
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="tourTime"><i class="fas fa-clock"></i> THỜI GIAN BẮT ĐẦU</label>
                        <input type="time" id="tourTime">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="durationMinutes"><i class="fas fa-hourglass-half"></i> THỜI LƯỢNG (PHÚT)</label>
                        <div class="duration-input-container">
                            <input type="number" id="durationMinutes" min="15" max="480" placeholder="VD: 60, 90, 120..." class="duration-input">
                            <span class="duration-unit">PHÚT</span>
                        </div>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="customerCount"><i class="fas fa-users"></i> SỐ LƯỢNG KHÁCH</label>
                        <input type="number" id="customerCount" min="1" max="100" placeholder="SỐ LƯỢNG KHÁCH...">
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="tourNotes"><i class="fas fa-sticky-note"></i> GHI CHÚ</label>
                <textarea id="tourNotes" rows="3" class="uppercase" placeholder="GHI CHÚ THÊM VỀ BOOKING..."></textarea>
            </div>
            
            <div class="action-buttons">
                <button class="btn" id="saveBookingBtn">
                    <i class="fas fa-save"></i> LƯU BOOKING
                </button>
                <button class="btn btn-secondary" id="clearBookingBtn">
                    <i class="fas fa-broom"></i> XÓA FORM
                </button>
            </div>
            
            <div class="form-group" style="margin-top: 40px;">
                <h2 class="section-title"><i class="fas fa-list"></i> DANH SÁCH BOOKING HÔM NAY</h2>
                
                <div id="todayBookingsList" class="booking-list">
                    <!-- Các booking hôm nay sẽ hiển thị ở đây -->
                </div>
            </div>
        </div>
        
        <!-- Tab Chia Phòng -->
        <div id="room-assignment" class="tab-content">
            <h2 class="section-title"><i class="fas fa-door-closed"></i> PHÂN CHIA PHÒNG</h2>
            
            <div id="roomAlert" class="alert" style="display:none;"></div>
            
            <div class="form-group">
                <label for="selectBooking"><i class="fas fa-calendar-alt"></i> CHỌN BOOKING</label>
                <select id="selectBooking">
                    <option value="">-- CHỌN BOOKING ĐỂ CHIA PHÒNG --</option>
                </select>
            </div>
            
            <div id="bookingInfoBox" style="display: none;">
                <div class="booking-card">
                    <div class="booking-header">
                        <div class="booking-title" id="selectedBookingName"></div>
                        <div class="booking-customer-count" id="selectedBookingCustomerCount"></div>
                    </div>
                    <div class="booking-details">
                        <div class="detail-row">
                            <div class="detail-label">NGÀY & GIỜ:</div>
                            <div class="detail-value" id="selectedBookingDateTime"></div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">THỜI LƯỢNG:</div>
                            <div class="detail-value" id="selectedBookingDuration"></div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">TRẠNG THÁI:</div>
                            <div class="detail-value"><span id="selectedBookingStatus" class="badge"></span></div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">NV ĐÃ PHÂN:</div>
                            <div class="detail-value" id="selectedBookingAssignedStaff"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="roomAssignmentSection" style="display: none; margin-top: 30px;">
                <h2 class="section-title"><i class="fas fa-user-plus"></i> PHÂN CHIA PHÒNG</h2>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="roomNumber"><i class="fas fa-door-closed"></i> SỐ PHÒNG</label>
                            <input type="text" id="roomNumber" class="uppercase" placeholder="VD: P101, P102...">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="roomCapacity"><i class="fas fa-user-friends"></i> SỨC CHỨA</label>
                            <select id="roomCapacity">
                                <option value="2">2 NGƯỜI</option>
                                <option value="3">3 NGƯỜI</option>
                                <option value="4">4 NGƯỜI</option>
                                <option value="5" selected>5 NGƯỜI</option>
                                <option value="6">6 NGƯỜI</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="staffCodes"><i class="fas fa-id-badge"></i> MÃ SỐ NHÂN VIÊN (PHÂN CÁCH BẰNG DẤU PHẨY)</label>
                    <input type="text" id="staffCodes" class="uppercase" placeholder="VD: NV001, NV002, NV003...">
                    <div id="duplicateWarning" class="duplicate-warning" style="display:none;">
                        <i class="fas fa-exclamation-triangle"></i> CẢNH BÁO: MỘT SỐ MÃ NHÂN VIÊN ĐÃ ĐƯỢC PHÂN CÔNG VÀO PHÒNG KHÁC!
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn" id="assignRoomBtn">
                        <i class="fas fa-user-plus"></i> THÊM PHÒNG
                    </button>
                    <button class="btn btn-success" id="autoAssignBtn">
                        <i class="fas fa-robot"></i> TỰ ĐỘNG CHIA PHÒNG
                    </button>
                    <button class="btn btn-warning" id="markCompleteBtn">
                        <i class="fas fa-check-circle"></i> ĐÁNH DẤU HOÀN THÀNH
                    </button>
                    <button class="btn btn-secondary" id="clearRoomFormBtn">
                        <i class="fas fa-times"></i> XÓA FORM
                    </button>
                </div>
                
                <div class="room-assignment-section">
                    <h3 class="section-title" style="font-size: 18px; margin-top: 30px;">
                        <i class="fas fa-hotel"></i> PHÒNG ĐÃ PHÂN CÔNG
                    </h3>
                    <div id="bookingRoomsList" class="room-list">
                        <!-- Các phòng đã phân công sẽ hiển thị ở đây -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tab Booking Tương Lai -->
        <div id="future-bookings" class="tab-content">
            <h2 class="section-title"><i class="fas fa-calendar-alt"></i> BOOKING TƯƠNG LAI</h2>
            
            <div class="filter-section">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="filterDate"><i class="fas fa-filter"></i> LỌC THEO NGÀY</label>
                            <input type="date" id="filterDate">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="filterStatus"><i class="fas fa-filter"></i> LỌC THEO TRẠNG THÁI</label>
                            <select id="filterStatus">
                                <option value="all">TẤT CẢ TRẠNG THÁI</option>
                                <option value="chua_phan_phong">CHƯA PHÂN PHÒNG</option>
                                <option value="dang_phan_phong">ĐANG PHÂN PHÒNG</option>
                                <option value="hoan_thanh">HOÀN THÀNH</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn" id="applyFilterBtn">
                        <i class="fas fa-filter"></i> ÁP DỤNG LỌC
                    </button>
                    <button class="btn btn-secondary" id="resetFilterBtn">
                        <i class="fas fa-redo"></i> ĐẶT LẠI LỌC
                    </button>
                </div>
            </div>
            
            <div class="tab-submenu">
                <button class="submenu-btn active" data-subtab="upcoming">SẮP TỚI</button>
                <button class="submenu-btn" data-subtab="this-week">TUẦN NÀY</button>
                <button class="submenu-btn" data-subtab="next-week">TUẦN SAU</button>
                <button class="submenu-btn" data-subtab="all-future">TẤT CẢ TƯƠNG LAI</button>
            </div>
            
            <div id="futureBookingsList" class="booking-list">
                <!-- Các booking tương lai sẽ hiển thị ở đây -->
            </div>
        </div>
        
        <!-- Tab Nhân Viên Off -->
        <div id="staff-off" class="tab-content">
            <h2 class="section-title"><i class="fas fa-user-slash"></i> QUẢN LÝ NHÂN VIÊN OFF</h2>
            
            <div id="staffOffAlert" class="alert" style="display:none;"></div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="staffSelect"><i class="fas fa-user"></i> CHỌN NHÂN VIÊN</label>
                        <select id="staffSelect">
                            <option value="">-- CHỌN NHÂN VIÊN --</option>
                        </select>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="offDate"><i class="fas fa-calendar-times"></i> NGÀY OFF</label>
                        <input type="date" id="offDate">
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="offReason"><i class="fas fa-sticky-note"></i> LÝ DO OFF (TÙY CHỌN)</label>
                <textarea id="offReason" rows="2" class="uppercase" placeholder="NHẬP LÝ DO NHÂN VIÊN OFF..."></textarea>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-warning" id="markOffBtn">
                    <i class="fas fa-user-slash"></i> ĐÁNH DẤU OFF
                </button>
                <button class="btn btn-success" id="markAvailableBtn">
                    <i class="fas fa-user-check"></i> ĐÁNH DẤU CÓ MẶT
                </button>
                <button class="btn btn-secondary" id="clearOffFormBtn">
                    <i class="fas fa-times"></i> XÓA FORM
                </button>
            </div>
            
            <div class="form-group" style="margin-top: 40px;">
                <h2 class="section-title"><i class="fas fa-calendar-times"></i> DANH SÁCH NHÂN VIÊN OFF HÔM NAY</h2>
                
                <div id="todayOffStaffList">
                    <!-- Danh sách nhân viên off hôm nay sẽ hiển thị ở đây -->
                </div>
            </div>
            
            <div class="form-group" style="margin-top: 40px;">
                <h2 class="section-title"><i class="fas fa-calendar-alt"></i> LỊCH OFF TRONG TUẦN</h2>
                
                <div class="filter-section">
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="offFilterDate"><i class="fas fa-calendar"></i> XEM OFF THEO NGÀY</label>
                                <input type="date" id="offFilterDate">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="offFilterStaff"><i class="fas fa-user"></i> LỌC THEO NHÂN VIÊN</label>
                                <input type="text" id="offFilterStaff" class="uppercase" placeholder="NHẬP MÃ HOẶC TÊN NV...">
                            </div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn" id="applyOffFilterBtn">
                            <i class="fas fa-filter"></i> ÁP DỤNG LỌC
                        </button>
                        <button class="btn btn-secondary" id="resetOffFilterBtn">
                            <i class="fas fa-redo"></i> ĐẶT LẠI LỌC
                        </button>
                    </div>
                </div>
                
                <table id="offScheduleTable">
                    <thead>
                        <tr>
                            <th>NHÂN VIÊN</th>
                            <th>NGÀY OFF</th>
                            <th>LÝ DO</th>
                            <th>TRẠNG THÁI</th>
                            <th>THAO TÁC</th>
                        </tr>
                    </thead>
                    <tbody id="offScheduleBody">
                        <!-- Lịch off sẽ hiển thị ở đây -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Tab Thống Kê -->
        <div id="statistics" class="tab-content">
            <h2 class="section-title"><i class="fas fa-chart-pie"></i> THỐNG KÊ HOẠT ĐỘNG</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <i class="fas fa-users fa-2x" style="color: #3498db;"></i>
                    <div class="stat-number" id="totalStaff">50</div>
                    <div class="stat-label">TỔNG NHÂN VIÊN</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-user-slash fa-2x" style="color: #e74c3c;"></i>
                    <div class="stat-number" id="offStaffToday">0</div>
                    <div class="stat-label">NV OFF HÔM NAY</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-calendar-day fa-2x" style="color: #2ecc71;"></i>
                    <div class="stat-number" id="totalBookingsToday">0</div>
                    <div class="stat-label">BOOKING HÔM NAY</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-calendar-alt fa-2x" style="color: #f39c12;"></i>
                    <div class="stat-number" id="futureBookingsCount">0</div>
                    <div class="stat-label">BOOKING TƯƠNG LAI</div>
                </div>
            </div>
            
            <h2 class="section-title" style="margin-top: 40px;">
                <i class="fas fa-user-tie"></i> THỐNG KÊ NHÂN VIÊN
            </h2>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="statDate"><i class="fas fa-calendar"></i> CHỌN NGÀY</label>
                        <input type="date" id="statDate">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="statStaffCode"><i class="fas fa-id-card"></i> LỌC THEO MÃ NV (TÙY CHỌN)</label>
                        <input type="text" id="statStaffCode" class="uppercase" placeholder="VD: NV001">
                    </div>
                </div>
            </div>
            
            <table id="statsTable">
                <thead>
                    <tr>
                        <th>MÃ NV</th>
                        <th>TÊN NHÂN VIÊN</th>
                        <th>SỐ BOOKING</th>
                        <th>PHÒNG ĐÃ PHÂN</th>
                        <th>TRẠNG THÁI HÔM NAY</th>
                    </tr>
                </thead>
                <tbody id="statsTableBody">
                    <!-- Dữ liệu thống kê sẽ được thêm ở đây -->
                </tbody>
            </table>
            
            <div class="action-buttons" style="margin-top: 30px;">
                <button class="btn" id="refreshStatsBtn">
                    <i class="fas fa-sync-alt"></i> LÀM MỚI THỐNG KÊ
                </button>
                <button class="btn btn-secondary" id="exportStatsBtn">
                    <i class="fas fa-file-export"></i> XUẤT THỐNG KÊ
                </button>
            </div>
        </div>
        
        <footer>
            <p>ỨNG DỤNG QUẢN LÝ BOOKING & CHIA PHÒNG &copy; 2023 - QUẢN LÝ 50 NHÂN VIÊN</p>
        </footer>
    </div>

    <script>
        // Dữ liệu cho 50 nhân viên
        const staffData = Array.from({length: 50}, (_, i) => {
            const staffNum = (i + 1).toString().padStart(3, '0');
            return {
                code: `NV${staffNum}`,
                name: `NHÂN VIÊN ${staffNum}`,
                bookingsAssigned: [], // Mảng chứa ID các booking đã được phân công
                roomsAssigned: [], // Mảng chứa các phòng đã phân công
                offDays: [], // Mảng chứa các ngày off [{date: '2023-12-25', reason: 'Nghỉ lễ'}]
                isAvailableToday: true // Mặc định có mặt
            };
        });
        
        // Dữ liệu ứng dụng
        let bookings = [];
        let roomAssignments = []; // Lưu trữ phân công phòng
        
        // Hiển thị ngày hiện tại
        function updateTodayDate() {
            const today = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('todayDate').textContent = 
                `HÔM NAY: ${today.toLocaleDateString('vi-VN', options).toUpperCase()}`;
        }
        
        // Chuyển đổi tab chính
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.getAttribute('data-tab');
                
                // Ẩn tất cả các tab
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // Bỏ active tất cả các nút tab
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Hiển thị tab được chọn
                document.getElementById(tabId).classList.add('active');
                button.classList.add('active');
                
                // Nếu là tab thống kê, cập nhật dữ liệu
                if (tabId === 'statistics') {
                    updateStatistics();
                }
                
                // Nếu là tab chia phòng, cập nhật danh sách booking
                if (tabId === 'room-assignment') {
                    updateBookingSelect();
                }
                
                // Nếu là tab booking, cập nhật danh sách booking hôm nay
                if (tabId === 'booking') {
                    updateTodayBookingsList();
                }
                
                // Nếu là tab booking tương lai
                if (tabId === 'future-bookings') {
                    showSubTabFuture('upcoming');
                    updateFutureBookingsList('upcoming');
                }
                
                // Nếu là tab nhân viên off
                if (tabId === 'staff-off') {
                    updateStaffSelect();
                    updateTodayOffStaffList();
                    updateOffScheduleTable();
                }
                
                // Xóa tất cả thông báo khi chuyển tab
                clearAllAlerts();
            });
        });
        
        // Xóa tất cả thông báo
        function clearAllAlerts() {
            document.querySelectorAll('.alert').forEach(alert => {
                alert.style.display = 'none';
            });
        }
        
        // Chuyển đổi subtab cho booking tương lai
        document.querySelectorAll('.submenu-btn').forEach(button => {
            button.addEventListener('click', () => {
                const subtabId = button.getAttribute('data-subtab');
                
                // Bỏ active tất cả các nút subtab
                document.querySelectorAll('.submenu-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Active nút được chọn
                button.classList.add('active');
                
                // Cập nhật danh sách booking theo subtab
                updateFutureBookingsList(subtabId);
            });
        });
        
        // Tự động chuyển sang chữ hoa khi nhập
        document.addEventListener('DOMContentLoaded', function() {
            const uppercaseInputs = document.querySelectorAll('.uppercase');
            uppercaseInputs.forEach(input => {
                input.addEventListener('input', function() {
                    this.value = this.value.toUpperCase();
                });
                
                // Cũng chuyển đổi giá trị hiện tại
                if (input.value) {
                    input.value = input.value.toUpperCase();
                }
            });
        });
        
        // Tab 1: Tạo booking mới
        document.getElementById('saveBookingBtn').addEventListener('click', () => {
            const tourName = document.getElementById('tourName').value.trim();
            const tourDate = document.getElementById('tourDate').value;
            const tourTime = document.getElementById('tourTime').value;
            const durationMinutes = document.getElementById('durationMinutes').value;
            const customerCount = document.getElementById('customerCount').value;
            const tourNotes = document.getElementById('tourNotes').value;
            
            if (!tourName || !tourDate || !tourTime || !durationMinutes || !customerCount) {
                showAlert('bookingAlert', 'VUI LÒNG ĐIỀN ĐẦY ĐỦ THÔNG TIN BẮT BUỘC!', 'danger');
                return;
            }
            
            // Kiểm tra ngày không được nhỏ hơn hôm nay
            const today = new Date().toISOString().split('T')[0];
            if (tourDate < today) {
                showAlert('bookingAlert', 'NGÀY BOOKING KHÔNG ĐƯỢC NHỎ HƠN NGÀY HÔM NAY!', 'danger');
                return;
            }
            
            // Tính thời gian kết thúc
            const startTime = new Date(`${tourDate}T${tourTime}`);
            const endTime = new Date(startTime.getTime() + parseInt(durationMinutes) * 60000);
            const endTimeString = endTime.toTimeString().slice(0, 5);
            
            // Tạo booking mới
            const booking = {
                id: Date.now(),
                name: tourName.toUpperCase(),
                date: tourDate,
                startTime: tourTime,
                endTime: endTimeString,
                durationMinutes: parseInt(durationMinutes),
                customers: parseInt(customerCount),
                notes: tourNotes.toUpperCase(),
                status: 'chua_phan_phong', // chua_phan_phong, dang_phan_phong, hoan_thanh
                rooms: [], // Mảng chứa các phòng đã phân công
                assignedStaff: [] // Mảng chứa các nhân viên đã phân công
            };
            
            bookings.push(booking);
            showAlert('bookingAlert', `ĐÃ LƯU BOOKING "${tourName.toUpperCase()}" THÀNH CÔNG!`, 'success');
            
            // Cập nhật giao diện
            updateTodayBookingsList();
            updateBookingSelect();
            updateFutureBookingsList('upcoming');
            updateStatistics();
            
            // KHÔNG xóa form để người dùng có thể tiếp tục nhập
            // Chỉ xóa khi người dùng nhấn nút "Xóa Form"
        });
        
        document.getElementById('clearBookingBtn').addEventListener('click', () => {
            clearBookingForm();
            showAlert('bookingAlert', 'ĐÃ XÓA THÔNG TIN FORM!', 'warning');
        });
        
        function clearBookingForm() {
            document.getElementById('tourName').value = '';
            document.getElementById('tourDate').value = '';
            document.getElementById('tourTime').value = '';
            document.getElementById('durationMinutes').value = '';
            document.getElementById('customerCount').value = '';
            document.getElementById('tourNotes').value = '';
        }
        
        // Tab 2: Chia phòng
        let selectedBookingId = null;
        
        // Cập nhật dropdown chọn booking
        function updateBookingSelect() {
            const selectBooking = document.getElementById('selectBooking');
            selectBooking.innerHTML = '<option value="">-- CHỌN BOOKING ĐỂ CHIA PHÒNG --</option>';
            
            // Lọc các booking chưa hoàn thành việc phân phòng
            const today = new Date().toISOString().split('T')[0];
            const availableBookings = bookings.filter(booking => 
                booking.status !== 'hoan_thanh' && booking.date >= today
            );
            
            if (availableBookings.length === 0) {
                selectBooking.innerHTML += '<option value="" disabled>KHÔNG CÓ BOOKING NÀO ĐỂ CHIA PHÒNG</option>';
                return;
            }
            
            availableBookings.forEach(booking => {
                const option = document.createElement('option');
                option.value = booking.id;
                option.textContent = `${booking.name} (${formatDate(booking.date)} ${booking.startTime}, ${booking.customers} KHÁCH)`;
                selectBooking.appendChild(option);
            });
        }
        
        // Khi chọn booking từ dropdown
        document.getElementById('selectBooking').addEventListener('change', function() {
            const bookingId = parseInt(this.value);
            selectedBookingId = bookingId;
            
            if (!bookingId) {
                document.getElementById('bookingInfoBox').style.display = 'none';
                document.getElementById('roomAssignmentSection').style.display = 'none';
                return;
            }
            
            const booking = bookings.find(b => b.id === bookingId);
            if (!booking) return;
            
            // Hiển thị thông tin booking
            document.getElementById('selectedBookingName').textContent = booking.name;
            document.getElementById('selectedBookingCustomerCount').textContent = `${booking.customers} KHÁCH`;
            document.getElementById('selectedBookingDateTime').textContent = `${formatDate(booking.date)} ${booking.startTime} - ${booking.endTime}`;
            document.getElementById('selectedBookingDuration').textContent = `${booking.durationMinutes} PHÚT`;
            
            const statusBadge = document.getElementById('selectedBookingStatus');
            statusBadge.textContent = getStatusText(booking.status);
            statusBadge.className = 'badge ' + getStatusClass(booking.status);
            
            document.getElementById('selectedBookingAssignedStaff').textContent = `${booking.assignedStaff.length} NHÂN VIÊN`;
            
            document.getElementById('bookingInfoBox').style.display = 'block';
            document.getElementById('roomAssignmentSection').style.display = 'block';
            
            // Hiển thị các phòng đã phân công cho booking này
            updateBookingRoomsList(bookingId);
            
            // Xóa form chia phòng
            clearRoomForm();
        });
        
        // Thêm phòng vào booking
        document.getElementById('assignRoomBtn').addEventListener('click', () => {
            if (!selectedBookingId) {
                showRoomAlert('VUI LÒNG CHỌN MỘT BOOKING TRƯỚC!', 'danger');
                return;
            }
            
            const roomNumber = document.getElementById('roomNumber').value.trim().toUpperCase();
            const roomCapacity = parseInt(document.getElementById('roomCapacity').value);
            const staffCodesInput = document.getElementById('staffCodes').value.trim();
            const booking = bookings.find(b => b.id === selectedBookingId);
            
            if (!roomNumber || !staffCodesInput) {
                showRoomAlert('VUI LÒNG ĐIỀN ĐẦY ĐỦ THÔNG TIN PHÒNG!', 'danger');
                return;
            }
            
            // Xử lý danh sách mã nhân viên
            const staffCodes = staffCodesInput.split(',')
                .map(code => code.trim().toUpperCase())
                .filter(code => code);
            
            if (staffCodes.length === 0) {
                showRoomAlert('VUI LÒNG NHẬP ÍT NHẤT MỘT MÃ NHÂN VIÊN!', 'danger');
                return;
            }
            
            if (staffCodes.length > roomCapacity) {
                showRoomAlert(`SỐ NHÂN VIÊN (${staffCodes.length}) VƯỢT QUÁ SỨC CHỨA PHÒNG (${roomCapacity})!`, 'danger');
                return;
            }
            
            // Kiểm tra xem phòng đã tồn tại trong booking chưa
            if (booking.rooms.some(room => room.number === roomNumber)) {
                showRoomAlert(`PHÒNG ${roomNumber} ĐÃ TỒN TẠI TRONG BOOKING NÀY!`, 'danger');
                return;
            }
            
            // Kiểm tra nhân viên có tồn tại không và có bị trùng không
            const validStaffCodes = [];
            const invalidStaffCodes = [];
            const duplicateStaffCodes = [];
            const offStaffCodes = [];
            
            const today = new Date().toISOString().split('T')[0];
            
            staffCodes.forEach(code => {
                // Kiểm tra nhân viên có tồn tại không
                const staff = staffData.find(s => s.code === code);
                if (!staff) {
                    invalidStaffCodes.push(code);
                    return;
                }
                
                // Kiểm tra nhân viên có off vào ngày của booking không
                const bookingDate = booking.date;
                const isOffOnBookingDate = staff.offDays.some(off => off.date === bookingDate);
                if (isOffOnBookingDate) {
                    offStaffCodes.push(code);
                    return;
                }
                
                // Kiểm tra nhân viên đã được phân công trong booking này chưa
                if (booking.assignedStaff.includes(code)) {
                    duplicateStaffCodes.push(code);
                    return;
                }
                
                validStaffCodes.push(code);
            });
            
            // Hiển thị cảnh báo
            let warningMessages = [];
            if (invalidStaffCodes.length > 0) {
                warningMessages.push(`MÃ NV KHÔNG HỢP LỆ: ${invalidStaffCodes.join(', ')}`);
            }
            if (duplicateStaffCodes.length > 0) {
                warningMessages.push(`NV ĐÃ PHÂN CÔNG: ${duplicateStaffCodes.join(', ')}`);
            }
            if (offStaffCodes.length > 0) {
                warningMessages.push(`NV OFF VÀO NGÀY ${formatDate(booking.date)}: ${offStaffCodes.join(', ')}`);
            }
            
            if (warningMessages.length > 0) {
                showRoomAlert(warningMessages.join(' | '), 'warning');
            }
            
            // Nếu không có nhân viên hợp lệ nào
            if (validStaffCodes.length === 0) {
                showRoomAlert('KHÔNG CÓ NHÂN VIÊN HỢP LỆ ĐỂ PHÂN CÔNG!', 'danger');
                return;
            }
            
            // Tạo phòng mới
            const room = {
                id: Date.now(),
                number: roomNumber,
                capacity: roomCapacity,
                staffCodes: validStaffCodes,
                bookingId: selectedBookingId,
                bookingName: booking.name
            };
            
            // Thêm phòng vào booking
            booking.rooms.push(room);
            
            // Thêm nhân viên vào danh sách đã phân công của booking
            validStaffCodes.forEach(code => {
                if (!booking.assignedStaff.includes(code)) {
                    booking.assignedStaff.push(code);
                }
                
                // Cập nhật thông tin nhân viên
                const staff = staffData.find(s => s.code === code);
                if (staff) {
                    if (!staff.bookingsAssigned.includes(booking.id)) {
                        staff.bookingsAssigned.push(booking.id);
                    }
                    staff.roomsAssigned.push(`${roomNumber} (${booking.name})`);
                }
            });
            
            // Cập nhật trạng thái booking
            updateBookingStatus(booking);
            
            showRoomAlert(`ĐÃ THÊM PHÒNG ${roomNumber} VỚI ${validStaffCodes.length} NHÂN VIÊN`, 'success');
            
            // Cập nhật giao diện
            updateBookingRoomsList(selectedBookingId);
            clearRoomForm();
            updateStatistics();
        });
        
        // Tự động chia phòng
        document.getElementById('autoAssignBtn').addEventListener('click', () => {
            if (!selectedBookingId) {
                showRoomAlert('VUI LÒNG CHỌN MỘT BOOKING TRƯỚC!', 'danger');
                return;
            }
            
            const booking = bookings.find(b => b.id === selectedBookingId);
            if (!booking) return;
            
            // Tính số lượng nhân viên cần thiết (giả sử mỗi khách cần 1 nhân viên)
            const staffNeeded = booking.customers;
            
            // Lấy danh sách nhân viên chưa được phân công trong booking này và không off vào ngày booking
            const availableStaff = staffData.filter(staff => 
                !booking.assignedStaff.includes(staff.code) &&
                !staff.offDays.some(off => off.date === booking.date)
            ).slice(0, staffNeeded); // Chỉ lấy số lượng cần thiết
            
            if (availableStaff.length < staffNeeded) {
                showRoomAlert(`KHÔNG ĐỦ NHÂN VIÊN! CẦN ${staffNeeded}, CHỈ CÓ ${availableStaff.length} NHÂN VIÊN CÓ SẴN.`, 'warning');
            }
            
            // Tự động chia vào các phòng (mặc định phòng 5 người)
            const roomCapacity = 5;
            let roomCounter = 1;
            
            for (let i = 0; i < availableStaff.length; i += roomCapacity) {
                const roomStaff = availableStaff.slice(i, i + roomCapacity);
                const staffCodes = roomStaff.map(staff => staff.code);
                
                // Tạo phòng
                const room = {
                    id: Date.now() + i,
                    number: `P${(booking.rooms.length + roomCounter).toString().padStart(3, '0')}`,
                    capacity: roomCapacity,
                    staffCodes: staffCodes,
                    bookingId: selectedBookingId,
                    bookingName: booking.name
                };
                
                // Thêm phòng vào booking
                booking.rooms.push(room);
                
                // Thêm nhân viên vào danh sách đã phân công của booking
                staffCodes.forEach(code => {
                    if (!booking.assignedStaff.includes(code)) {
                        booking.assignedStaff.push(code);
                    }
                    
                    // Cập nhật thông tin nhân viên
                    const staff = staffData.find(s => s.code === code);
                    if (staff) {
                        if (!staff.bookingsAssigned.includes(booking.id)) {
                            staff.bookingsAssigned.push(booking.id);
                        }
                        staff.roomsAssigned.push(`${room.number} (${booking.name})`);
                    }
                });
                
                roomCounter++;
            }
            
            // Cập nhật trạng thái booking
            updateBookingStatus(booking);
            
            showRoomAlert(`ĐÃ TỰ ĐỘNG CHIA ${availableStaff.length} NHÂN VIÊN VÀO ${Math.ceil(availableStaff.length / roomCapacity)} PHÒNG`, 'success');
            
            // Cập nhật giao diện
            updateBookingRoomsList(selectedBookingId);
            clearRoomForm();
            updateStatistics();
        });
        
        // Đánh dấu hoàn thành booking
        document.getElementById('markCompleteBtn').addEventListener('click', () => {
            if (!selectedBookingId) {
                showRoomAlert('VUI LÒNG CHỌN MỘT BOOKING TRƯỚC!', 'danger');
                return;
            }
            
            const booking = bookings.find(b => b.id === selectedBookingId);
            if (!booking) return;
            
            if (booking.assignedStaff.length < booking.customers) {
                if (!confirm(`BOOKING NÀY MỚI PHÂN CÔNG ĐƯỢC ${booking.assignedStaff.length}/${booking.customers} NHÂN VIÊN. BẠN VẪN MUỐN ĐÁNH DẤU HOÀN THÀNH?`)) {
                    return;
                }
            }
            
            booking.status = 'hoan_thanh';
            showRoomAlert(`ĐÃ ĐÁNH DẤU BOOKING "${booking.name}" HOÀN THÀNH!`, 'success');
            
            // Cập nhật giao diện
            updateBookingRoomsList(selectedBookingId);
            updateBookingSelect();
            updateFutureBookingsList('upcoming');
            updateStatistics();
        });
        
        document.getElementById('clearRoomFormBtn').addEventListener('click', clearRoomForm);
        
        function clearRoomForm() {
            document.getElementById('roomNumber').value = '';
            document.getElementById('staffCodes').value = '';
            document.getElementById('duplicateWarning').style.display = 'none';
        }
        
        // Kiểm tra trùng lặp khi nhập mã nhân viên
        document.getElementById('staffCodes').addEventListener('input', function() {
            if (!selectedBookingId) return;
            
            const staffCodesInput = this.value.trim();
            if (!staffCodesInput) {
                document.getElementById('duplicateWarning').style.display = 'none';
                return;
            }
            
            const booking = bookings.find(b => b.id === selectedBookingId);
            if (!booking) return;
            
            const staffCodes = staffCodesInput.split(',')
                .map(code => code.trim().toUpperCase())
                .filter(code => code);
            
            const duplicates = [];
            
            staffCodes.forEach(code => {
                if (booking.assignedStaff.includes(code)) {
                    duplicates.push(code);
                }
            });
            
            if (duplicates.length > 0) {
                document.getElementById('duplicateWarning').style.display = 'block';
                document.getElementById('duplicateWarning').innerHTML = 
                    `<i class="fas fa-exclamation-triangle"></i> CẢNH BÁO: ${duplicates.length} NHÂN VIÊN ĐÃ ĐƯỢC PHÂN CÔNG (${duplicates.join(', ')})!`;
            } else {
                document.getElementById('duplicateWarning').style.display = 'none';
            }
        });
        
        // Cập nhật danh sách phòng của booking
        function updateBookingRoomsList(bookingId) {
            const booking = bookings.find(b => b.id === bookingId);
            if (!booking) return;
            
            const roomsList = document.getElementById('bookingRoomsList');
            roomsList.innerHTML = '';
            
            if (booking.rooms.length === 0) {
                roomsList.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 30px; color: #7f8c8d;">
                        <i class="fas fa-door-closed fa-3x" style="margin-bottom: 15px; opacity: 0.5;"></i>
                        <h4>CHƯA CÓ PHÒNG NÀO ĐƯỢC PHÂN CÔNG</h4>
                        <p>HÃY THÊM PHÒNG ĐẦU TIÊN BẰNG FORM BÊN TRÊN</p>
                    </div>
                `;
                return;
            }
            
            booking.rooms.forEach(room => {
                const roomElement = document.createElement('div');
                roomElement.className = 'room-card';
                
                // Tạo danh sách nhân viên trong phòng
                let staffListHTML = '';
                room.staffCodes.forEach(code => {
                    const staff = staffData.find(s => s.code === code);
                    staffListHTML += `
                        <li>
                            ${code} - ${staff ? staff.name : 'KHÔNG XÁC ĐỊNH'}
                        </li>
                    `;
                });
                
                roomElement.innerHTML = `
                    <div class="room-header">
                        <div class="room-title">PHÒNG ${room.number}</div>
                        <div class="room-capacity">${room.staffCodes.length}/${room.capacity} NGƯỜI</div>
                    </div>
                    <div><strong><i class="fas fa-id-badge"></i> NHÂN VIÊN:</strong></div>
                    <ul class="staff-list">
                        ${staffListHTML || '<li style="text-align: center; color: #7f8c8d;">CHƯA CÓ NHÂN VIÊN</li>'}
                    </ul>
                    <div class="room-actions">
                        <button class="btn-remove-room" onclick="removeRoom(${bookingId}, ${room.id})">
                            <i class="fas fa-trash"></i> XÓA PHÒNG
                        </button>
                    </div>
                `;
                
                roomsList.appendChild(roomElement);
            });
        }
        
        // Hàm xóa phòng
        window.removeRoom = function(bookingId, roomId) {
            if (!confirm('BẠN CÓ CHẮC CHẮN MUỐN XÓA PHÒNG NÀY?')) {
                return;
            }
            
            const booking = bookings.find(b => b.id === bookingId);
            if (!booking) return;
            
            const roomIndex = booking.rooms.findIndex(r => r.id === roomId);
            if (roomIndex === -1) return;
            
            const room = booking.rooms[roomIndex];
            
            // Xóa nhân viên khỏi danh sách đã phân công của booking
            room.staffCodes.forEach(code => {
                const staffIndex = booking.assignedStaff.indexOf(code);
                if (staffIndex !== -1) {
                    booking.assignedStaff.splice(staffIndex, 1);
                }
                
                // Cập nhật thông tin nhân viên
                const staff = staffData.find(s => s.code === code);
                if (staff) {
                    // Xóa booking khỏi danh sách booking của nhân viên
                    const bookingIndex = staff.bookingsAssigned.indexOf(bookingId);
                    if (bookingIndex !== -1) {
                        staff.bookingsAssigned.splice(bookingIndex, 1);
                    }
                    
                    // Xóa phòng khỏi danh sách phòng của nhân viên
                    const roomAssignment = `${room.number} (${booking.name})`;
                    const roomIndex = staff.roomsAssigned.indexOf(roomAssignment);
                    if (roomIndex !== -1) {
                        staff.roomsAssigned.splice(roomIndex, 1);
                    }
                }
            });
            
            // Xóa phòng khỏi booking
            booking.rooms.splice(roomIndex, 1);
            
            // Cập nhật trạng thái booking
            updateBookingStatus(booking);
            
            showRoomAlert(`ĐÃ XÓA PHÒNG ${room.number}`, 'warning');
            
            // Cập nhật giao diện
            updateBookingRoomsList(bookingId);
            updateStatistics();
        };
        
        // Tab 3: Booking tương lai
        function showSubTabFuture(subtabId) {
            // Bỏ active tất cả các nút subtab
            document.querySelectorAll('.submenu-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Active nút được chọn
            document.querySelector(`[data-subtab="${subtabId}"]`).classList.add('active');
        }
        
        function updateFutureBookingsList(filterType = 'upcoming') {
            const futureBookingsList = document.getElementById('futureBookingsList');
            futureBookingsList.innerHTML = '';
            
            const today = new Date().toISOString().split('T')[0];
            let filteredBookings = [];
            
            // Lọc booking theo loại
            switch(filterType) {
                case 'upcoming':
                    // Booking từ ngày mai trở đi
                    const tomorrow = new Date();
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    const tomorrowStr = tomorrow.toISOString().split('T')[0];
                    filteredBookings = bookings.filter(booking => booking.date >= tomorrowStr);
                    break;
                    
                case 'this-week':
                    // Booking trong tuần này
                    const startOfWeek = getStartOfWeek();
                    const endOfWeek = getEndOfWeek();
                    filteredBookings = bookings.filter(booking => 
                        booking.date >= startOfWeek && booking.date <= endOfWeek
                    );
                    break;
                    
                case 'next-week':
                    // Booking tuần sau
                    const startOfNextWeek = getStartOfNextWeek();
                    const endOfNextWeek = getEndOfNextWeek();
                    filteredBookings = bookings.filter(booking => 
                        booking.date >= startOfNextWeek && booking.date <= endOfNextWeek
                    );
                    break;
                    
                case 'all-future':
                    // Tất cả booking tương lai
                    filteredBookings = bookings.filter(booking => booking.date > today);
                    break;
            }
            
            // Áp dụng bộ lọc ngày nếu có
            const filterDate = document.getElementById('filterDate').value;
            if (filterDate) {
                filteredBookings = filteredBookings.filter(booking => booking.date === filterDate);
            }
            
            // Áp dụng bộ lọc trạng thái nếu có
            const filterStatus = document.getElementById('filterStatus').value;
            if (filterStatus !== 'all') {
                filteredBookings = filteredBookings.filter(booking => booking.status === filterStatus);
            }
            
            // Sắp xếp theo ngày
            filteredBookings.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            if (filteredBookings.length === 0) {
                futureBookingsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-calendar-times"></i>
                        <h3>KHÔNG CÓ BOOKING NÀO</h3>
                        <p>HÃY TẠO BOOKING MỚI TRONG TAB NHẬN BOOKING</p>
                    </div>
                `;
                return;
            }
            
            filteredBookings.forEach(booking => {
                const bookingElement = document.createElement('div');
                bookingElement.className = 'booking-card';
                
                // Xác định class CSS dựa trên ngày booking
                let dateClass = 'booking-status-future';
                if (booking.date === today) {
                    dateClass = 'booking-status-today';
                } else if (booking.date < today) {
                    dateClass = 'booking-status-past';
                }
                bookingElement.classList.add(dateClass);
                
                bookingElement.innerHTML = `
                    <div class="booking-header">
                        <div class="booking-title">${booking.name}</div>
                        <div class="booking-customer-count">${booking.customers} KHÁCH</div>
                    </div>
                    <div class="booking-details">
                        <div class="detail-row">
                            <div class="detail-label">NGÀY:</div>
                            <div class="detail-value">${formatDate(booking.date)} (${getDayOfWeek(booking.date)})</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">THỜI GIAN:</div>
                            <div class="detail-value">${booking.startTime} - ${booking.endTime}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">THỜI LƯỢNG:</div>
                            <div class="detail-value">${booking.durationMinutes} PHÚT</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">TRẠNG THÁI:</div>
                            <div class="detail-value"><span class="badge ${getStatusClass(booking.status)}">${getStatusText(booking.status)}</span></div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">PHÒNG:</div>
                            <div class="detail-value">${booking.rooms.length} PHÒNG</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">NV ĐÃ PHÂN:</div>
                            <div class="detail-value">${booking.assignedStaff.length} NHÂN VIÊN</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">GHI CHÚ:</div>
                            <div class="detail-value">${booking.notes || 'KHÔNG CÓ'}</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-secondary" onclick="selectBookingForAssignment(${booking.id})" style="width: 100%;">
                            <i class="fas fa-door-open"></i> CHIA PHÒNG CHO BOOKING NÀY
                        </button>
                    </div>
                `;
                
                futureBookingsList.appendChild(bookingElement);
            });
        }
        
        // Áp dụng bộ lọc cho booking tương lai
        document.getElementById('applyFilterBtn').addEventListener('click', () => {
            const activeSubTab = document.querySelector('.submenu-btn.active');
            if (activeSubTab) {
                const subtabId = activeSubTab.getAttribute('data-subtab');
                updateFutureBookingsList(subtabId);
            }
        });
        
        document.getElementById('resetFilterBtn').addEventListener('click', () => {
            document.getElementById('filterDate').value = '';
            document.getElementById('filterStatus').value = 'all';
            const activeSubTab = document.querySelector('.submenu-btn.active');
            if (activeSubTab) {
                const subtabId = activeSubTab.getAttribute('data-subtab');
                updateFutureBookingsList(subtabId);
            }
        });
        
        // Tab 4: Quản lý nhân viên off
        function updateStaffSelect() {
            const staffSelect = document.getElementById('staffSelect');
            staffSelect.innerHTML = '<option value="">-- CHỌN NHÂN VIÊN --</option>';
            
            staffData.forEach(staff => {
                const option = document.createElement('option');
                option.value = staff.code;
                option.textContent = `${staff.code} - ${staff.name}`;
                staffSelect.appendChild(option);
            });
        }
        
        // Đánh dấu nhân viên off
        document.getElementById('markOffBtn').addEventListener('click', () => {
            const staffCode = document.getElementById('staffSelect').value;
            const offDate = document.getElementById('offDate').value;
            const offReason = document.getElementById('offReason').value.trim();
            
            if (!staffCode || !offDate) {
                showAlert('staffOffAlert', 'VUI LÒNG CHỌN NHÂN VIÊN VÀ NGÀY OFF!', 'danger');
                return;
            }
            
            const staff = staffData.find(s => s.code === staffCode);
            if (!staff) return;
            
            // Kiểm tra xem nhân viên đã off ngày này chưa
            const alreadyOff = staff.offDays.some(off => off.date === offDate);
            if (alreadyOff) {
                showAlert('staffOffAlert', `NHÂN VIÊN ${staffCode} ĐÃ OFF VÀO NGÀY ${formatDate(offDate)}!`, 'warning');
                return;
            }
            
            // Thêm ngày off
            staff.offDays.push({
                date: offDate,
                reason: offReason.toUpperCase() || 'KHÔNG CÓ LÝ DO'
            });
            
            // Nếu là off hôm nay, cập nhật trạng thái
            const today = new Date().toISOString().split('T')[0];
            if (offDate === today) {
                staff.isAvailableToday = false;
            }
            
            showAlert('staffOffAlert', `ĐÃ ĐÁNH DẤU NHÂN VIÊN ${staffCode} OFF VÀO NGÀY ${formatDate(offDate)}`, 'success');
            
            // Cập nhật giao diện
            updateTodayOffStaffList();
            updateOffScheduleTable();
            updateStatistics();
            
            // Xóa form
            clearOffForm();
        });
        
        // Đánh dấu nhân viên có mặt
        document.getElementById('markAvailableBtn').addEventListener('click', () => {
            const staffCode = document.getElementById('staffSelect').value;
            const offDate = document.getElementById('offDate').value;
            
            if (!staffCode || !offDate) {
                showAlert('staffOffAlert', 'VUI LÒNG CHỌN NHÂN VIÊN VÀ NGÀY!', 'danger');
                return;
            }
            
            const staff = staffData.find(s => s.code === staffCode);
            if (!staff) return;
            
            // Xóa ngày off nếu có
            const offIndex = staff.offDays.findIndex(off => off.date === offDate);
            if (offIndex !== -1) {
                staff.offDays.splice(offIndex, 1);
                
                // Nếu là hôm nay, cập nhật trạng thái
                const today = new Date().toISOString().split('T')[0];
                if (offDate === today) {
                    staff.isAvailableToday = true;
                }
                
                showAlert('staffOffAlert', `ĐÃ XÓA OFF CHO NHÂN VIÊN ${staffCode} VÀO NGÀY ${formatDate(offDate)}`, 'success');
            } else {
                showAlert('staffOffAlert', `NHÂN VIÊN ${staffCode} KHÔNG OFF VÀO NGÀY ${formatDate(offDate)}`, 'warning');
            }
            
            // Cập nhật giao diện
            updateTodayOffStaffList();
            updateOffScheduleTable();
            updateStatistics();
            
            // Xóa form
            clearOffForm();
        });
        
        document.getElementById('clearOffFormBtn').addEventListener('click', clearOffForm);
        
        function clearOffForm() {
            document.getElementById('staffSelect').value = '';
            document.getElementById('offDate').value = '';
            document.getElementById('offReason').value = '';
        }
        
        // Cập nhật danh sách nhân viên off hôm nay
        function updateTodayOffStaffList() {
            const todayOffStaffList = document.getElementById('todayOffStaffList');
            todayOffStaffList.innerHTML = '';
            
            const today = new Date().toISOString().split('T')[0];
            const offStaffToday = staffData.filter(staff => 
                staff.offDays.some(off => off.date === today)
            );
            
            if (offStaffToday.length === 0) {
                todayOffStaffList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-check"></i>
                        <h3>KHÔNG CÓ NHÂN VIÊN NÀO OFF HÔM NAY</h3>
                        <p>TẤT CẢ NHÂN VIÊN ĐỀU CÓ MẶT</p>
                    </div>
                `;
                return;
            }
            
            offStaffToday.forEach(staff => {
                const offDay = staff.offDays.find(off => off.date === today);
                
                const staffItem = document.createElement('div');
                staffItem.className = 'staff-off-item';
                
                staffItem.innerHTML = `
                    <div class="staff-off-info">
                        <div class="staff-avatar">${staff.code.substring(2)}</div>
                        <div>
                            <div><strong>${staff.code}</strong> - ${staff.name}</div>
                            <div style="color: #e74c3c; font-size: 14px; margin-top: 5px;">
                                <i class="fas fa-info-circle"></i> LÝ DO: ${offDay.reason}
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-danger btn-sm" onclick="removeOffDay('${staff.code}', '${today}')">
                        <i class="fas fa-user-check"></i> XÓA OFF
                    </button>
                `;
                
                todayOffStaffList.appendChild(staffItem);
            });
        }
        
        // Cập nhật bảng lịch off
        function updateOffScheduleTable() {
            const offScheduleBody = document.getElementById('offScheduleBody');
            offScheduleBody.innerHTML = '';
            
            const filterDate = document.getElementById('offFilterDate').value;
            const filterStaff = document.getElementById('offFilterStaff').value.trim().toUpperCase();
            
            // Tạo mảng tất cả ngày off
            let allOffDays = [];
            staffData.forEach(staff => {
                staff.offDays.forEach(offDay => {
                    allOffDays.push({
                        staffCode: staff.code,
                        staffName: staff.name,
                        date: offDay.date,
                        reason: offDay.reason
                    });
                });
            });
            
            // Áp dụng bộ lọc
            if (filterDate) {
                allOffDays = allOffDays.filter(off => off.date === filterDate);
            }
            
            if (filterStaff) {
                allOffDays = allOffDays.filter(off => 
                    off.staffCode.includes(filterStaff) || 
                    off.staffName.toUpperCase().includes(filterStaff)
                );
            }
            
            // Sắp xếp theo ngày
            allOffDays.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            if (allOffDays.length === 0) {
                offScheduleBody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 30px; color: #7f8c8d;">
                            <i class="fas fa-calendar-check"></i> KHÔNG CÓ LỊCH OFF NÀO
                        </td>
                    </tr>
                `;
                return;
            }
            
            allOffDays.forEach(off => {
                const today = new Date().toISOString().split('T')[0];
                let status = '';
                if (off.date < today) {
                    status = `<span class="badge" style="background-color: #95a5a6; color: white;">ĐÃ QUA</span>`;
                } else if (off.date === today) {
                    status = `<span class="badge badge-danger">HÔM NAY</span>`;
                } else {
                    status = `<span class="badge badge-warning">SẮP TỚI</span>`;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${off.staffCode}</strong> - ${off.staffName}</td>
                    <td>${formatDate(off.date)} (${getDayOfWeek(off.date)})</td>
                    <td>${off.reason}</td>
                    <td>${status}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="removeOffDay('${off.staffCode}', '${off.date}')">
                            <i class="fas fa-trash"></i> XÓA
                        </button>
                    </td>
                `;
                offScheduleBody.appendChild(row);
            });
        }
        
        // Hàm xóa off day (có thể gọi từ button)
        window.removeOffDay = function(staffCode, date) {
            const staff = staffData.find(s => s.code === staffCode);
            if (!staff) return;
            
            const offIndex = staff.offDays.findIndex(off => off.date === date);
            if (offIndex !== -1) {
                staff.offDays.splice(offIndex, 1);
                
                // Nếu là hôm nay, cập nhật trạng thái
                const today = new Date().toISOString().split('T')[0];
                if (date === today) {
                    staff.isAvailableToday = true;
                }
                
                showAlert('staffOffAlert', `ĐÃ XÓA OFF CHO NHÂN VIÊN ${staffCode} VÀO NGÀY ${formatDate(date)}`, 'success');
                
                // Cập nhật giao diện
                updateTodayOffStaffList();
                updateOffScheduleTable();
                updateStatistics();
            }
        };
        
        // Áp dụng bộ lọc cho lịch off
        document.getElementById('applyOffFilterBtn').addEventListener('click', updateOffScheduleTable);
        document.getElementById('resetOffFilterBtn').addEventListener('click', () => {
            document.getElementById('offFilterDate').value = '';
            document.getElementById('offFilterStaff').value = '';
            updateOffScheduleTable();
        });
        
        // Tab 5: Thống kê
        document.getElementById('refreshStatsBtn').addEventListener('click', updateStatistics);
        
        document.getElementById('exportStatsBtn').addEventListener('click', () => {
            alert('CHỨC NĂNG XUẤT THỐNG KÊ ĐANG ĐƯỢC PHÁT TRIỂN!');
        });
        
        // Hàm cập nhật thống kê
        function updateStatistics() {
            const today = new Date().toISOString().split('T')[0];
            
            // Lọc booking hôm nay
            const todayBookings = bookings.filter(booking => booking.date === today);
            
            // Lọc booking tương lai
            const futureBookings = bookings.filter(booking => booking.date > today);
            
            // Đếm nhân viên off hôm nay
            const offStaffToday = staffData.filter(staff => 
                staff.offDays.some(off => off.date === today)
            ).length;
            
            // Cập nhật thống kê tổng quan
            document.getElementById('totalBookingsToday').textContent = todayBookings.length;
            document.getElementById('futureBookingsCount').textContent = futureBookings.length;
            document.getElementById('offStaffToday').textContent = offStaffToday;
            
            // Cập nhật bảng thống kê nhân viên
            updateStaffStatsTable();
        }
        
        // Cập nhật bảng thống kê nhân viên
        function updateStaffStatsTable() {
            const statDate = document.getElementById('statDate').value;
            const staffCodeFilter = document.getElementById('statStaffCode').value.trim().toUpperCase();
            
            const statsTableBody = document.getElementById('statsTableBody');
            statsTableBody.innerHTML = '';
            
            // Lọc nhân viên theo mã (nếu có)
            let filteredStaff = staffData;
            if (staffCodeFilter) {
                filteredStaff = staffData.filter(staff => 
                    staff.code.includes(staffCodeFilter) || 
                    staff.name.toUpperCase().includes(staffCodeFilter)
                );
            }
            
            // Sắp xếp nhân viên theo số booking (giảm dần)
            filteredStaff.sort((a, b) => b.bookingsAssigned.length - a.bookingsAssigned.length);
            
            if (filteredStaff.length === 0) {
                statsTableBody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 30px; color: #7f8c8d;">
                            <i class="fas fa-user-slash fa-2x" style="margin-bottom: 10px;"></i><br>
                            KHÔNG TÌM THẤY NHÂN VIÊN PHÙ HỢP
                        </td>
                    </tr>
                `;
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            const selectedDate = statDate || today;
            
            filteredStaff.forEach(staff => {
                // Đếm số booking trong ngày được chọn
                let bookingCount = 0;
                if (selectedDate) {
                    bookingCount = staff.bookingsAssigned.filter(bookingId => {
                        const booking = bookings.find(b => b.id === bookingId);
                        return booking && booking.date === selectedDate;
                    }).length;
                }
                
                // Kiểm tra nhân viên có off vào ngày được chọn không
                const isOff = staff.offDays.some(off => off.date === selectedDate);
                
                // Xác định trạng thái
                let status = '';
                if (isOff) {
                    const offDay = staff.offDays.find(off => off.date === selectedDate);
                    status = `<span class="badge badge-danger">OFF (${offDay.reason})</span>`;
                } else if (bookingCount > 0) {
                    status = `<span class="badge badge-success">ĐANG LÀM VIỆC (${bookingCount} BOOKING)</span>`;
                } else {
                    status = `<span class="badge badge-info">RẢNH</span>`;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${staff.code}</strong></td>
                    <td>${staff.name}</td>
                    <td><strong>${bookingCount}</strong> BOOKING</td>
                    <td>${staff.roomsAssigned.length > 0 ? staff.roomsAssigned.slice(0, 2).join(', ') : 'CHƯA PHÂN CÔNG'}${staff.roomsAssigned.length > 2 ? '...' : ''}</td>
                    <td>${status}</td>
                `;
                statsTableBody.appendChild(row);
            });
        }
        
        // Hàm cập nhật danh sách booking hôm nay
        function updateTodayBookingsList() {
            const today = new Date().toISOString().split('T')[0];
            const todayBookingsList = document.getElementById('todayBookingsList');
            todayBookingsList.innerHTML = '';
            
            // Lọc booking hôm nay
            const todayBookings = bookings.filter(booking => booking.date === today);
            
            if (todayBookings.length === 0) {
                todayBookingsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-calendar-times"></i>
                        <h3>KHÔNG CÓ BOOKING NÀO HÔM NAY</h3>
                        <p>HÃY TẠO BOOKING MỚI BẰNG FORM BÊN TRÊN</p>
                    </div>
                `;
                return;
            }
            
            todayBookings.forEach(booking => {
                const bookingElement = document.createElement('div');
                bookingElement.className = 'booking-card booking-status-today';
                
                bookingElement.innerHTML = `
                    <div class="booking-header">
                        <div class="booking-title">${booking.name}</div>
                        <div class="booking-customer-count">${booking.customers} KHÁCH</div>
                    </div>
                    <div class="booking-details">
                        <div class="detail-row">
                            <div class="detail-label">THỜI GIAN:</div>
                            <div class="detail-value">${booking.startTime} - ${booking.endTime}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">THỜI LƯỢNG:</div>
                            <div class="detail-value">${booking.durationMinutes} PHÚT</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">TRẠNG THÁI:</div>
                            <div class="detail-value"><span class="badge ${getStatusClass(booking.status)}">${getStatusText(booking.status)}</span></div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">PHÒNG:</div>
                            <div class="detail-value">${booking.rooms.length} PHÒNG</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">NV ĐÃ PHÂN:</div>
                            <div class="detail-value">${booking.assignedStaff.length} NHÂN VIÊN</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-secondary" onclick="selectBookingForAssignment(${booking.id})" style="width: 100%;">
                            <i class="fas fa-door-open"></i> CHIA PHÒNG CHO BOOKING NÀY
                        </button>
                    </div>
                `;
                
                todayBookingsList.appendChild(bookingElement);
            });
        }
        
        // Hàm chọn booking để chia phòng (từ tab booking)
        window.selectBookingForAssignment = function(bookingId) {
            // Chuyển sang tab chia phòng
            document.querySelector('[data-tab="room-assignment"]').click();
            
            // Chọn booking trong dropdown
            document.getElementById('selectBooking').value = bookingId;
            
            // Kích hoạt sự kiện change
            const event = new Event('change');
            document.getElementById('selectBooking').dispatchEvent(event);
        };
        
        // Hàm hiển thị cảnh báo (ĐÃ SỬA - không tự động ẩn)
        function showAlert(alertId, message, type) {
            const alertElement = document.getElementById(alertId);
            alertElement.textContent = message.toUpperCase();
            alertElement.className = `alert alert-${type}`;
            alertElement.style.display = 'flex';
            
            // KHÔNG có timeout tự động ẩn
            // Người dùng có thể đóng thông báo bằng cách chuyển tab hoặc nhấn nút khác
        }
        
        // Hàm hiển thị cảnh báo trong tab chia phòng
        function showRoomAlert(message, type) {
            showAlert('roomAlert', message, type);
        }
        
        // Hàm cập nhật trạng thái booking
        function updateBookingStatus(booking) {
            if (booking.assignedStaff.length >= booking.customers) {
                booking.status = 'hoan_thanh';
            } else if (booking.assignedStaff.length > 0) {
                booking.status = 'dang_phan_phong';
            } else {
                booking.status = 'chua_phan_phong';
            }
        }
        
        // Hàm trợ giúp
        function getStatusText(status) {
            const statusMap = {
                'chua_phan_phong': 'CHƯA PHÂN PHÒNG',
                'dang_phan_phong': 'ĐANG PHÂN PHÒNG',
                'hoan_thanh': 'HOÀN THÀNH'
            };
            return statusMap[status] || status;
        }
        
        function getStatusClass(status) {
            const classMap = {
                'chua_phan_phong': 'badge-warning',
                'dang_phan_phong': 'badge-success',
                'hoan_thanh': 'badge-success'
            };
            return classMap[status] || 'badge';
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('vi-VN');
        }
        
        function getDayOfWeek(dateString) {
            const date = new Date(dateString);
            const days = ['CHỦ NHẬT', 'THỨ 2', 'THỨ 3', 'THỨ 4', 'THỨ 5', 'THỨ 6', 'THỨ 7'];
            return days[date.getDay()];
        }
        
        function getStartOfWeek() {
            const today = new Date();
            const dayOfWeek = today.getDay();
            const diff = today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1); // Thứ 2 là đầu tuần
            const startOfWeek = new Date(today.setDate(diff));
            return startOfWeek.toISOString().split('T')[0];
        }
        
        function getEndOfWeek() {
            const startOfWeek = new Date(getStartOfWeek());
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(endOfWeek.getDate() + 6);
            return endOfWeek.toISOString().split('T')[0];
        }
        
        function getStartOfNextWeek() {
            const startOfWeek = new Date(getStartOfWeek());
            const startOfNextWeek = new Date(startOfWeek);
            startOfNextWeek.setDate(startOfNextWeek.getDate() + 7);
            return startOfNextWeek.toISOString().split('T')[0];
        }
        
        function getEndOfNextWeek() {
            const startOfNextWeek = new Date(getStartOfNextWeek());
            const endOfNextWeek = new Date(startOfNextWeek);
            endOfNextWeek.setDate(endOfNextWeek.getDate() + 6);
            return endOfNextWeek.toISOString().split('T')[0];
        }
        
        // Khởi tạo ứng dụng khi trang được tải
        document.addEventListener('DOMContentLoaded', () => {
            updateTodayDate();
            
            // Đặt ngày mặc định cho các trường date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tourDate').value = today;
            document.getElementById('tourDate').min = today;
            document.getElementById('offDate').value = today;
            document.getElementById('statDate').value = today;
            document.getElementById('filterDate').value = '';
            document.getElementById('offFilterDate').value = '';
            
            // Gắn sự kiện cho các trường thống kê
            document.getElementById('statDate').addEventListener('change', updateStaffStatsTable);
            document.getElementById('statStaffCode').addEventListener('input', updateStaffStatsTable);
            
            // Thêm một số booking mẫu
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];
            
            // Thêm off cho một vài nhân viên
            staffData[0].offDays.push({date: today, reason: 'NGHỈ ỐM'});
            staffData[0].isAvailableToday = false;
            
            staffData[1].offDays.push({date: tomorrowStr, reason: 'NGHỈ PHÉP'});
            
            // Cập nhật giao diện
            updateTodayBookingsList();
            updateBookingSelect();
            updateFutureBookingsList('upcoming');
            updateStaffSelect();
            updateTodayOffStaffList();
            updateOffScheduleTable();
            updateStatistics();
        });
    </script>
</body>
</html>